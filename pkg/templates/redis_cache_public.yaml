id: redis_cache_public_access
name: Publicly Accessible Redis Caches
description: Detects Redis Cache instances with public network access enabled
severity: High
category: ["Public Access", "arg-scan"]
triageNotes: |
  Potential Risk:
  - Public accessibility exposes the cache endpoint to the entire internet
  - Could lead to unauthorized access attempts and data exposure
  - May impact performance due to processing unauthorized requests (DoS)
  
  Triage Guidance:
  - This finding only confirms the cache is accessible from the internet and not anonymous access
  - Additional manual testing is required to determine if anonymous/unauthorized access is possible
references:
  - https://learn.microsoft.com/en-us/azure/azure-cache-for-redis/cache-network-isolation
query: |
    resources
    | where type =~ 'Microsoft.Cache/Redis'
    | extend publicNetworkAccess = tolower(properties.publicNetworkAccess)
    | extend sku = properties.sku.name
    | extend enableNonSslPort = properties.enableNonSslPort
    | extend minimumTlsVersion = properties.minimumTlsVersion
    | extend hostname = properties.hostName
    | extend subnetId = properties.subnetId
    | where isempty(subnetId)
    | where publicNetworkAccess != 'disabled'
    | project
        id,
        name,
        type,
        location,
        publicNetworkAccess,
        sku,
        enableNonSslPort,
        minimumTlsVersion,
        hostname,
        subscriptionId