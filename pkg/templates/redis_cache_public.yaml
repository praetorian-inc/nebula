id: redis_cache_public_access
name: Publicly Accessible Redis Caches
description: Detects Redis Cache instances with public network access enabled that are not integrated with a virtual network. Note that all access still requires authentication via access keys or Azure AD, as anonymous access is not supported.
severity: Low
category: ["Public Access", "arg-scan"]
reportability: Manual Triage
triageNotes: |
  Important Context:
  Azure Cache for Redis does not support truly anonymous or unauthenticated access. Authentication is always required to connect and use the cache, regardless of public network access settings.

  Authentication Methods:
  - Access Keys: Shared secret keys that provide full access to the cache
  - Microsoft Entra ID (Azure AD) Authentication: Password-free, token-based authentication with RBAC support via Redis Access Control Lists (ACLs)
  - Built-in access policies (Data Owner, Data Contributor, Data Reader) can be assigned via Azure RBAC using Microsoft Entra identities
  - You cannot disable authentication entirely to allow anonymous access

  Understanding Public Network Access:
  - "Public network access" refers to network-level connectivity from the internet, not authentication bypass
  - All Redis operations still require valid access keys or Azure AD authentication
  - Public access means Redis endpoints are reachable from the internet (subject to authentication)
  - VNet integration automatically makes the cache non-publicly addressable, regardless of public network access settings
  - Private access restricts network connectivity to virtual networks or private endpoints only

  VNet Integration Considerations:
  - Redis caches configured with virtual network integration are not publicly addressable
  - VNet integration provides network-level isolation and is only available for Premium tier caches
  - This scan specifically targets caches WITHOUT VNet integration that have public access enabled

  Potential Considerations:
  - Increased attack surface through internet-accessible cache endpoints
  - Potential for authentication brute force attempts against access keys
  - Network-level exposure may facilitate reconnaissance of cache infrastructure
  - Consider whether VNet integration or private endpoints would better align with security posture

  Triage Guidance:
  - Verify if public network access is operationally required for your caching scenarios
  - Review authentication methods in use (access keys vs Azure AD) and validate permissions
  - Consider implementing VNet integration (Premium tier) for network-level isolation
  - Validate any firewall rules or IP restrictions protecting the cache
  - Assess if the current configuration aligns with organizational security policies
  - Review Redis ACLs and access policies to ensure principle of least privilege

  Remediation Considerations:
  - Disable public network access if not required for business operations
  - Implement VNet integration (requires Premium tier) for secure connectivity
  - Configure firewall rules to restrict access to specific IP ranges if public access is necessary
  - Consider using Azure AD authentication instead of access keys for enhanced security
  - Review and validate Redis ACLs and built-in access policies
  - Enable SSL/TLS and disable non-SSL port if currently enabled
references:
  - https://learn.microsoft.com/en-us/azure/azure-cache-for-redis/cache-network-isolation
  - https://learn.microsoft.com/en-us/azure/azure-cache-for-redis/cache-how-to-premium-vnet
  - https://learn.microsoft.com/en-us/azure/azure-cache-for-redis/cache-azure-active-directory-for-authentication
query: |
    resources
    | where type =~ 'Microsoft.Cache/Redis'
    | extend publicNetworkAccess = tolower(properties.publicNetworkAccess)
    | extend sku = properties.sku.name
    | extend enableNonSslPort = properties.enableNonSslPort
    | extend minimumTlsVersion = properties.minimumTlsVersion
    | extend hostname = properties.hostName
    | extend subnetId = properties.subnetId
    | where isempty(subnetId)  // Only caches WITHOUT VNet integration
    | where publicNetworkAccess != 'disabled'  // Only caches with public access enabled
    | project
        id,
        name,
        type,
        location,
        resourceGroup,
        publicNetworkAccess,
        sku,
        enableNonSslPort,
        minimumTlsVersion,
        hostname,
        subnetId,
        subscriptionId