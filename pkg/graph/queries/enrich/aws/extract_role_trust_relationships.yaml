name: Extract Role Trust Relationships
description: Parses role trust policies to extract specific principals, account root trusts, and public access patterns
impactedServices:
  - IAM
severity: Informational
order: 20
cypher: |
  MATCH (role:AWS_IAM_Role)
  WHERE role.assumeRolePolicyDoc IS NOT NULL

  // Check for public/wildcard trust
  WITH role,
    (role.assumeRolePolicyDoc CONTAINS '"Principal":"*"'
     OR role.assumeRolePolicyDoc CONTAINS '"AWS":"*"') AS trustsPublic,
    (role.assumeRolePolicyDoc CONTAINS ':root') AS trustsAccountRoot

  // Set the properties
  SET role.trustsPublic = trustsPublic,
      role.trustsAccountRoot = trustsAccountRoot

  RETURN count(role) as RolesProcessed
