{
  "platform": "aws",
  "module": "find-secrets",
  "Filename": "aws/cloudformation/555045483459/eu-west-1-AutoTag-Collector.json",
  "data": "{\n  \"AWSTemplateFormatVersion\": \"2010-09-09\",\n  \"Description\": \"Auto Tag (Open Source by GorillaStack)\",\n\n  \"Parameters\" : {\n    \"MainAwsRegion\" : {\n      \"Description\" : \"The region where the main auto-tag CloudFormation stack is running\",\n      \"Type\" : \"String\",\n      \"Default\": \"us-west-2\"\n    }\n  },\n\n  \"Resources\": {\n\n    \"EC2EventRule\": {\n      \"Type\": \"AWS::Events::Rule\",\n      \"Properties\": {\n        \"Description\": \"Auto-tag resources with Lambda from CloudTrail events\",\n        \"EventPattern\": {\n          \"detail-type\": [\n            \"AWS API Call via CloudTrail\"\n          ],\n          \"detail\": {\n            \"eventSource\": [\n              \"autoscaling.amazonaws.com\",\n              \"datapipeline.amazonaws.com\",\n              \"dynamodb.amazonaws.com\",\n              \"ec2.amazonaws.com\",\n              \"events.amazonaws.com\",\n              \"elasticloadbalancing.amazonaws.com\",\n              \"elasticmapreduce.amazonaws.com\",\n              \"iam.amazonaws.com\",\n              \"lambda.amazonaws.com\",\n              \"logs.amazonaws.com\",\n              \"monitoring.amazonaws.com\",\n              \"opsworks.amazonaws.com\",\n              \"rds.amazonaws.com\",\n              \"s3.amazonaws.com\"\n            ],\n            \"eventName\": [\n              \"AllocateAddress\",\n              \"CloneStack\",\n              \"CopyImage\",\n              \"CopySnapshot\",\n              \"CreateAutoScalingGroup\",\n              \"CreateBucket\",\n              \"CreateCustomerGateway\",\n              \"CreateDBInstance\",\n              \"CreateDhcpOptions\",\n              \"CreateFunction20150331\",\n              \"CreateFunction20141111\",\n              \"CreateImage\",\n              \"CreateInternetGateway\",\n              \"CreateLoadBalancer\",\n              \"CreateLogGroup\",\n              \"CreateNatGateway\",\n              \"CreateNetworkAcl\",\n              \"CreateNetworkInterface\",\n              \"CreatePipeline\",\n              \"CreateRole\",\n              \"CreateRouteTable\",\n              \"CreateSecurityGroup\",\n              \"CreateSnapshot\",\n              \"CreateStack\",\n              \"CreateSubnet\",\n              \"CreateTable\",\n              \"CreateUser\",\n              \"CreateVolume\",\n              \"CreateVpc\",\n              \"CreateVpnConnection\",\n              \"CreateVpnGateway\",\n              \"CreateVpcPeeringConnection\",\n              \"ImportSnapshot\",\n              \"PutMetricAlarm\",\n              \"PutRule\",\n              \"RegisterImage\",\n              \"RunInstances\",\n              \"RunJobFlow\"\n            ]\n          }\n        },\n        \"Name\": \"AutoTag-CloudTrail-Events\",\n        \"State\": \"ENABLED\",\n        \"Targets\": [\n          {\n            \"Arn\": {\n              \"Ref\": \"AutoTagSNSTopic\"\n            },\n            \"Id\": \"Main\"\n          }\n        ]\n      }\n    },\n\n    \"AutoTagSNSTopic\": {\n      \"Type\": \"AWS::SNS::Topic\",\n      \"Properties\": {\n        \"DisplayName\": \"AutoTag CloudTrail Events\",\n        \"TopicName\": \"AutoTag\"\n      }\n    },\n\n    \"AutoTagSNSTopicPolicy\": {\n      \"Type\": \"AWS::SNS::TopicPolicy\",\n      \"Properties\": {\n        \"PolicyDocument\": {\n          \"Id\": \"AutoTagSNSTopicPolicy\",\n          \"Version\": \"2012-10-17\",\n          \"Statement\": [\n            {\n              \"Sid\": \"AllowCloudWatchRuleSNSPublish\",\n              \"Effect\": \"Allow\",\n              \"Principal\": { \"Service\" : \"events.amazonaws.com\" },\n              \"Action\": \"sns:Publish\",\n              \"Resource\": \"*\"\n            }\n          ]\n        },\n        \"Topics\": [\n          {\n            \"Ref\": \"AutoTagSNSTopic\"\n          }\n        ]\n      }\n    },\n\n    \"AutoTagSNSSubscription\": {\n      \"Type\": \"AWS::SNS::Subscription\",\n      \"Properties\": {\n        \"Endpoint\": { \"Fn::Sub\": \"arn:aws:lambda:${MainAwsRegion}:${AWS::AccountId}:function:AutoTag\" },\n        \"Protocol\": \"lambda\",\n        \"TopicArn\": {\n          \"Ref\": \"AutoTagSNSTopic\"\n        }\n      }\n    }\n  }\n}"
}