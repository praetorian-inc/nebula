id: data_factory_public_access
name: Data Factory Self-Hosted Integration Runtime Network Configuration
description: Identifies Azure Data Factory instances where Self-Hosted Integration Runtime (SHIR) communication is not restricted to private networks. SHIR enables secure hybrid data integration between on-premises systems and Azure, often processing sensitive enterprise data.
severity: Info
category: ["Public Access", "arg-scan"]
reportability: Manual Triage 
triageNotes: |-
  Usually not reportable unless exceptional circumstances as stated below
  
  SHIR Purpose:
  - Bridges on-premises databases/systems with Azure Data Factory securely
  - Common data: Financial records, customer PII, compliance-regulated datasets
  - Network exposure affects SHIR communication only (*.datafactory.azure.net, *.servicebus.windows.net)
  
  Risk Assessment:
  - Data Factory management plane remains publicly accessible regardless of this setting
  - Many Data Factories don't actually use SHIR - verify deployment before prioritizing
  - Higher priority for production instances processing sensitive on-premises data
  - Consider compliance requirements (PCI-DSS, HIPAA) that may mandate private network isolation
  
  Validation:
  1. Confirm SHIR is deployed and active
  2. Identify sensitive data sources (on-premises databases, SAP, etc.)
  3. Assess if private endpoints are justified based on data classification and compliance needs
references:
  - https://learn.microsoft.com/en-us/azure/data-factory/create-self-hosted-integration-runtime
  - https://learn.microsoft.com/en-us/azure/data-factory/data-movement-security-considerations
  - https://learn.microsoft.com/en-us/azure/data-factory/
query: |-
    resources
    | where type =~ 'Microsoft.DataFactory/factories'
    | extend publicNetworkAccess = case(
        isempty(properties.publicNetworkAccess), 'enabled',  // Azure default behavior
        tolower(properties.publicNetworkAccess) == 'disabled', 'disabled',
        'enabled'  // All other cases treated as enabled
    )
    | extend purviewEnabled = isnotempty(properties.purviewConfiguration.purviewResourceId)
    | extend repoConfigured = isnotempty(properties.repoConfiguration)
    | extend encryptionConfigured = isnotempty(properties.encryption)
    | where publicNetworkAccess != 'disabled'
    | project
        id,
        name,
        type,
        location,
        publicNetworkAccess,
        purviewEnabled,
        repoConfigured,
        encryptionConfigured,
        subscriptionId,
        resourceGroup
