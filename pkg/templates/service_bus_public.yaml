id: service_bus_public_access
name: Publicly Accessible Service Bus Namespaces
description: Detects Service Bus namespaces with public network access enabled. Note that all access still requires authentication via SAS tokens or Azure AD, as anonymous access is not supported.
severity: Low
category: ["Public Access", "arg-scan"]
reportability: Manual Triage
triageNotes: |
  Important Context:
  Azure Service Bus queues and topics cannot be accessed anonymously or without authentication. Access to these messaging entities always requires authentication through supported methods, regardless of public network access settings.

  Authentication Methods:
  - Shared Access Signatures (SAS): Access controlled via shared access policies that produce time-limited SAS tokens with specific permissions (send, listen, manage)
  - Microsoft Entra ID (Azure AD): Role-based access control (RBAC) enforced via Azure AD identities with granular OAuth 2.0 permissions
  - No configuration allows anonymous or unauthenticated access to queues, topics, or subscriptions

  Understanding Public Network Access:
  - "Public network access" refers to network-level connectivity from the internet, not authentication bypass
  - All messaging operations still require valid SAS tokens or Azure AD authentication

  Potential Considerations:
  - Increased attack surface through internet-accessible messaging endpoints
  - Potential for exposed credentials to be used to authenticate to the messaging endpoints
  - Network-level exposure may facilitate reconnaissance of messaging infrastructure

  Triage Guidance:
  - Validate any mitigating controls (e.g., IP restrictions or network security groups protecting the namespace)

  Remediation Considerations:
  - Disable public network access if not required for business operations
  - Implement private endpoints for secure connectivity from Azure resources
  - Configure IP firewall rules if public access is necessary
references:
  - https://learn.microsoft.com/en-us/azure/service-bus-messaging/network-security
  - https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-authentication-and-authorization
  - https://learn.microsoft.com/en-us/azure/service-bus-messaging/private-link-service
query: |
    resources
    | where type =~ 'Microsoft.ServiceBus/namespaces'
    | extend publicNetworkAccess = tolower(properties.publicNetworkAccess)
    | extend networkRuleSets = properties.networkRuleSets
    | extend defaultAction = tolower(coalesce(properties.networkRuleSets.defaultAction, 'allow'))
    | extend sku = properties.sku.name
    | extend endpoint = properties.serviceBusEndpoint
    | extend zoneRedundant = properties.zoneRedundant
    | where publicNetworkAccess != 'disabled'
    | where defaultAction == 'allow' or
        isnull(networkRuleSets.ipRules) or
        networkRuleSets.ipRules has '0.0.0.0' or
        networkRuleSets.ipRules has '0.0.0.0/0' or
        networkRuleSets.ipRules has '*' or
        networkRuleSets.ipRules has 'Internet'
    | project
        id,
        name,
        type,
        location,
        publicNetworkAccess,
        defaultAction,
        sku,
        endpoint,
        zoneRedundant,
        subscriptionId,
        resourceGroup
