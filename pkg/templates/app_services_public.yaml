id: app_services_public_access
name: Publicly Accessible App Services
description: Detects app services without virtual network integration
category: ["Public Access", "arg-scan"]
severity: High
reportability: Automatic
triageNotes: |
  Potential Risks:
  - Public accessibility exposes the application to the entire internet, increasing the attack surface
  - Could lead to unauthorized access attempts, DDoS attacks, and potential exploitation of application vulnerabilities
  - May violate security compliance requirements for internal-only services

  Triage Guidance:
  - This finding only confirms the app service is accessible from the internet
  - Browse to the application from the Internet to determine anonymous access
references:
  - https://learn.microsoft.com/en-us/azure/app-service/overview-vnet-integration
query: |
    resources
      | where type =~ 'microsoft.web/sites'
      | extend hasPrivateEndpoint = isnotnull(properties.privateEndpointConnections) and
      array_length(properties.privateEndpointConnections) > 0
      | extend hasIpRestrictions = isnotnull(properties.siteConfig.ipSecurityRestrictions) and
      array_length(properties.siteConfig.ipSecurityRestrictions) > 0
      | extend publicNetworkAccess = coalesce(properties.publicNetworkAccess, 'Enabled')
      | extend isPubliclyAccessible = (
          publicNetworkAccess != 'Disabled' and
          not(hasPrivateEndpoint) and
          not(hasIpRestrictions)
      )
      | where isPubliclyAccessible == true