id: app_services_public_access
name: Publicly Accessible App Services
description: Detects app services without virtual network integration
severity: High
reportability: Automatic
triageNotes: |
  Potential Risks:
  - Public accessibility exposes the application to the entire internet, increasing the attack surface
  - Could lead to unauthorized access attempts, DDoS attacks, and potential exploitation of application vulnerabilities
  - May violate security compliance requirements for internal-only services

  Triage Guidance:
  - This finding only confirms the app service is accessible from the internet
  - Browse to the application from the Internet to determine anonymous access
references:
  - https://learn.microsoft.com/en-us/azure/app-service/overview-vnet-integration
query: |
    resources
    | where type =~ 'microsoft.web/sites'
    | extend publicAccess = iif(
        isnull(properties.virtualNetworkSubnetId) or properties.virtualNetworkSubnetId == '', 
        true, 
        false
    )
    | where publicAccess == true
    | project
        id,
        name,
        type,
        location,
        publicNetworkAccess = publicAccess,
        kind,
        subscriptionId
