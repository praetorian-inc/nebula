name: Privesc Method 5 - CreateLoginProfile
description: Creates CAN_PRIVESC relationship when a principal can create login profiles for other users
impactedServices:
  - IAM
severity: High
order: 109
cypher: |
  MATCH (principal)-[:IAM_CREATELOGINPROFILE]->(user:AWS_IAM_User)
    WHERE principal.admin IS NULL

  // Create the privesc relationship
  MERGE (principal)-[privesc:CAN_PRIVESC]->(user)
  ON CREATE SET
    privesc.method = "Method-05-CreateLoginProfile",
    privesc.requires = ["iam:CreateLoginProfile"],
    privesc.service = "IAM",
    privesc.targetType = "User"
  ON MATCH SET
    privesc.method = CASE
      WHEN NOT privesc.method CONTAINS "Method-05-CreateLoginProfile"
      THEN privesc.method + ",Method-05-CreateLoginProfile"
      ELSE privesc.method
    END

